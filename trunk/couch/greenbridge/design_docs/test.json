{
   "_id": "_design/test",
   "language": "javascript",
   "views": {
       "project": {
           "map": "function(doc) {\n  if(doc.type == 'project') {\n      emit('project', doc);\n  }\n  if (doc.type == 'person') {\n      emit('person', doc);\n  }\n}"
       }
   },
   "lists": {
       "freemind": "function (head, req) {     var name = 'test'; \tif (req.query.name != null) name = req.query.name; \tstart({'headers': {'Content-Type': 'application/x-freemind', 'Content-disposition':'attachment; filename='+name+'.mm'}}); \tvar row; \tvar project_id = req.query.project; \tvar project; \tvar people = new Array(); \t \twhile(row = getRow()) { \t\tif (row.key == 'project' && row.id == project_id) { \t\t\tproject = row.value; \t\t} \t\tif (row.key == 'person') { \t\t\tpeople.push(row.value) \t\t} \t} \tvar xml = new Array(); \txml.push(\"<map version='0.9.0'> <!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net --> <attribute_registry>\"); \tif (project.availableTags != null) { \t\txml.push(\"<attribute_name NAME='tag' VISIBLE='true'>\"); \t\tfor (var i=0; i < project.availableTags.length; i++) { \t\t\txml.push(\"<attribute_value VALUE='\" + project.availableTags[i] +\"'/>\"); \t\t} \t\txml.push(\"    </attribute_name> \"); \t} \tif (people.length > 0) { \t\txml.push(\"<attribute_name NAME='person' VISIBLE='true'>\"); \t\tfor (var i=0; i < people.length; i++) { \t\t\txml.push(\"<attribute_value VALUE='\" + people[i]._id +\"'/>\"); \t\t}\t\t \t\txml.push(\"    </attribute_name> \"); \t} \txml.push(\"    </attribute_registry> <node CREATED='1254284804593' ID='ID_1216022750' MODIFIED='1254295035593' TEXT='meeting'>\");     xml.push(\"       <attribute NAME='project' VALUE='\"+ project_id +\"'/>  \"); \tif (project.defaultAttendees != null) { \t\tfor (var i=0; i < project.defaultAttendees.length; i++) { \t\t       xml.push(\"       <attribute NAME='attendee' VALUE='\"+ project.defaultAttendees[i] +\"'/>  \"); \t\t} \t} \txml.push(\"</node> </map>\"); \tsend(new XML(xml.join(''))); }"
   }
}